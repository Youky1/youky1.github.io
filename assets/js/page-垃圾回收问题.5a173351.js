(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{650:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"垃圾回收问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收问题"}},[s._v("#")]),s._v(" 垃圾回收问题")]),s._v(" "),t("h2",{attrs:{id:"什么是内存泄漏"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是内存泄漏"}},[s._v("#")]),s._v(" 什么是内存泄漏")]),s._v(" "),t("blockquote",[t("p",[s._v("不再使用的内存没有及时释放")])]),s._v(" "),t("h2",{attrs:{id:"哪些情况会引起内存泄漏"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#哪些情况会引起内存泄漏"}},[s._v("#")]),s._v(" 哪些情况会引起内存泄漏")]),s._v(" "),t("blockquote",[t("p",[s._v("无法在通过js代码引用某个对象，但垃圾回收机制却认为这个对象还在被引用，因此不会释放")])]),s._v(" "),t("ul",[t("li",[s._v("意外的声明全局变量：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("a = 10;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("函数内意外使用this")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("foo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'foo'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// foo声明为了全局变量")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("定时器/闭包：引用了外部变量时，只要闭包返回的函数存在，该变量就不会被清理")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("保留了对DOM的引用，在DOM节点删除后没有释放")])]),s._v(" "),t("h2",{attrs:{id:"垃圾回收会对哪些内容进行回收"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收会对哪些内容进行回收"}},[s._v("#")]),s._v(" 垃圾回收会对哪些内容进行回收")]),s._v(" "),t("p",[s._v("只针对堆内存里的变量，执行栈中的变量在执行结束后直接就丢弃了。")]),s._v(" "),t("h2",{attrs:{id:"垃圾回收机制的两种策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收机制的两种策略"}},[s._v("#")]),s._v(" 垃圾回收机制的两种策略")]),s._v(" "),t("h3",{attrs:{id:"引用计数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#引用计数"}},[s._v("#")]),s._v(" 引用计数")]),s._v(" "),t("p",[s._v("用一张“引用表”存储所有资源的引用次数。当一个资源的引用次数为0时，将对其进行回收。")]),s._v(" "),t("p",[t("strong",[s._v("缺点")]),s._v("：无法解决循环引用问题")]),s._v(" "),t("h3",{attrs:{id:"标记清除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#标记清除"}},[s._v("#")]),s._v(" 标记清除")]),s._v(" "),t("p",[s._v("最常用的垃圾回收方式\n过程：")]),s._v(" "),t("ol",[t("li",[s._v("首先，给内存中存储的所有变量做上标记")]),s._v(" "),t("li",[s._v("去掉在当前上下文中的变量，以及被这些变量引用的变量")]),s._v(" "),t("li",[s._v("回收仍然带有标记的变量")])]),s._v(" "),t("h2",{attrs:{id:"管理内存的好习惯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理内存的好习惯"}},[s._v("#")]),s._v(" 管理内存的好习惯")]),s._v(" "),t("ol",[t("li",[s._v("只存储必要的数据，当变量不再需要时，将其赋值为null（结束引用）")]),s._v(" "),t("li",[s._v("使用const和let。因为二者以块为作用域，可以更早的进行垃圾回收")]),s._v(" "),t("li",[s._v("使用WeakMap和WeakSet")])])])}),[],!1,null,null,null);t.default=e.exports}}]);