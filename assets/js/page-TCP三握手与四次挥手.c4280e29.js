(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{679:function(s,a,t){"use strict";t.r(a);var e=t(1),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"tcp三握手与四次挥手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp三握手与四次挥手"}},[s._v("#")]),s._v(" TCP三握手与四次挥手")]),s._v(" "),a("h2",{attrs:{id:"三次握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[s._v("#")]),s._v(" 三次握手")]),s._v(" "),a("h3",{attrs:{id:"过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[s._v("#")]),s._v(" 过程")]),s._v(" "),a("ol",[a("li",[s._v("客户端向服务端发送连接请求的"),a("strong",[s._v("SYN报文")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SYN seq = x\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("服务端收到后，即可确认客户端的"),a("strong",[s._v("发送能力")]),s._v("，并回复"),a("strong",[s._v("ACK报文")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACk seq=y, ack=x+1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("客户端收到后，即可确认双方的收发能力，但此时服务端不确定自己的发送能力和客户端的接收能力。因此客户端回复一个ACK报文")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACK seq=x+1, ack=y+1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("至此，双方都确认了彼此的收发能力，握手完成。")]),s._v(" "),a("h3",{attrs:{id:"为什么不能是两次握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么不能是两次握手"}},[s._v("#")]),s._v(" 为什么不能是两次握手")]),s._v(" "),a("p",[s._v("如果是两次握手，即只要服务端收到来自客户端的SYN报文就建立连接。")]),s._v(" "),a("p",[s._v("如果客户端初始的SYN报文在网络中滞留，TCP会认为是丢包并进行重传。")]),s._v(" "),a("p",[s._v("因此，如果当前连接断开后，这个滞留的报文到达了服务端，则会建立起连接，而此时显然是一种资源的浪费。")]),s._v(" "),a("h3",{attrs:{id:"快速打开tfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速打开tfo"}},[s._v("#")]),s._v(" 快速打开TFO")]),s._v(" "),a("p",[s._v("利用SYN Cookie技术，收到客户端SYN报文后，计算出一个cookie值并保存。首次连接的三次握手照常进行")]),s._v(" "),a("p",[s._v("在后续连接中，服务端收到客户端请求后校验cookie值，若合法则在返回ACK报文后，"),a("strong",[s._v("即可开始传递数据")]),s._v("，免去了等待客户端ACK报文的时间")]),s._v(" "),a("h2",{attrs:{id:"四次挥手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[s._v("#")]),s._v(" 四次挥手")]),s._v(" "),a("h3",{attrs:{id:"过程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过程-2"}},[s._v("#")]),s._v(" 过程")]),s._v(" "),a("ol",[a("li",[s._v("由客户端发起，首先发送一个"),a("strong",[s._v("FIN报文")]),s._v("。此时，客户端不能再发送数据，只能接收")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FIN seq=x\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("服务端收到后，马上返回一个"),a("strong",[s._v("ACK报文")]),s._v("，并继续数据传输")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACK ack=x+1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("当服务端传输完剩余数据后，发送一个"),a("strong",[s._v("FIN报文")]),s._v("，表示数据传输完成")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FIN seq=y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("客户端收到后，返回一个ACK报文。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ACK ack=y+1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("之后：")]),s._v(" "),a("ul",[a("li",[s._v("服务端收到ACK报文后马上进入关闭状态")]),s._v(" "),a("li",[s._v("客户端在等待2个"),a("code",[s._v("MSL（Maximum Segment Lifetime，报文最大生存时间）")]),s._v("后,若没有收到重传请求，则进入关闭状态")])]),s._v(" "),a("h3",{attrs:{id:"为什么不是三次挥手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么不是三次挥手"}},[s._v("#")]),s._v(" 为什么不是三次挥手")]),s._v(" "),a("p",[s._v("服务端返回的ACK报文和FIN报文之间一般是有一定的延迟的，因为需要先将数据全部发送。")]),s._v(" "),a("p",[s._v("若将这两步合并，客户端迟迟没有收到回应的FIN报文，可能会认为是自己的ACK报文丢包，从而不断进行重传。")]),s._v(" "),a("h3",{attrs:{id:"等待2msl的意义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#等待2msl的意义"}},[s._v("#")]),s._v(" 等待2MSL的意义")]),s._v(" "),a("p",[s._v("客户端发送ACK报文时，服务器端返回的数据可能还在网络中没有到达，此时若直接关闭连接，则可能造成丢包。")]),s._v(" "),a("ul",[a("li",[s._v("第一个MSL内，保证所有数据到达客户端")]),s._v(" "),a("li",[s._v("第二个MSL内，保证若有重传请求，可以到达客户端")])])])}),[],!1,null,null,null);a.default=r.exports}}]);