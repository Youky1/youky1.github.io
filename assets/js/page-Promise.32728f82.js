(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{584:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"promise"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise"}},[s._v("#")]),s._v(" Promise")]),s._v(" "),t("h2",{attrs:{id:"基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),t("ul",[t("li",[s._v("Promise共有三种可能的状态，一个Promise只能出现两种：初始化状态、成功状态、失败状态。状态"),t("strong",[s._v("只能改变一次")])]),s._v(" "),t("li",[s._v("Promise构造函数中的代码为"),t("strong",[s._v("同步代码")]),s._v("，回调函数为"),t("strong",[s._v("微任务")])])]),s._v(" "),t("h2",{attrs:{id:"promise为什么能解决回调地狱"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise为什么能解决回调地狱"}},[s._v("#")]),s._v(" Promise为什么能解决回调地狱")]),s._v(" "),t("h3",{attrs:{id:"回调地狱主要代表两个问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回调地狱主要代表两个问题"}},[s._v("#")]),s._v(" 回调地狱主要代表两个问题")]),s._v(" "),t("ol",[t("li",[s._v("多层嵌套")]),s._v(" "),t("li",[s._v("每个任务的处理结果存在两种可能性，在每种任务结束后都要分别处理这两种情况")])]),s._v(" "),t("h3",{attrs:{id:"promise的解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise的解决方法"}},[s._v("#")]),s._v(" Promise的解决方法")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("返回值穿透")]),s._v("：在回调函数中返回Promise，可以实现链式调用（"),t("em",[s._v("解决多层嵌套问题")]),s._v("）")]),s._v(" "),t("li",[t("strong",[s._v("错误冒泡")]),s._v("：前面产生的错误会一直向后传递，被catch接收到（"),t("em",[s._v("解决重复处理两种情况的问题")]),s._v("）")])]),s._v(" "),t("h2",{attrs:{id:"为什么promise的回调是微任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么promise的回调是微任务"}},[s._v("#")]),s._v(" 为什么Promise的回调是微任务")]),s._v(" "),t("p",[s._v("如果不引入"),t("code",[s._v("微任务")]),s._v("，则回调中的异步任务会加入宏任务队列，也就是所有宏任务的末尾，这会导致回调函数间隔很长时间才能执行。")]),s._v(" "),t("p",[s._v("理想情况应该是添加到"),t("strong",[s._v("当前宏任务")]),s._v("的后面，因此引入了微任务。")]),s._v(" "),t("h2",{attrs:{id:"then和catch的位置关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#then和catch的位置关系"}},[s._v("#")]),s._v(" then和catch的位置关系")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'catch'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'then'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输出：catch then")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Promise")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reject")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'then'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'catch'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输出：catch")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("原因："),t("code",[s._v("then")]),s._v("和"),t("code",[s._v("catch")]),s._v("执行后都会返回一个promise，所以这两个方法都可以链式调用。")]),s._v(" "),t("p",[t("code",[s._v("catch")]),s._v("中只要没有显示抛出错误，其返回的promise都是成功状态。")]),s._v(" "),t("h2",{attrs:{id:"其他api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他api"}},[s._v("#")]),s._v(" 其他API")]),s._v(" "),t("h3",{attrs:{id:"promise-resolve"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise-resolve"}},[s._v("#")]),s._v(" Promise.resolve")]),s._v(" "),t("p",[s._v("接收一个参数value，返回一个"),t("code",[s._v("resolved")]),s._v("状态的promise实例，value会作为其成功回调函数的参数。")]),s._v(" "),t("h3",{attrs:{id:"promise-reject"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise-reject"}},[s._v("#")]),s._v(" Promise.reject")]),s._v(" "),t("p",[s._v("接收一个参数reason，返回一个"),t("code",[s._v("rejected")]),s._v("状态的promise实例，reason会作为其失败回调函数的参数")]),s._v(" "),t("h3",{attrs:{id:"promise-all"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise-all"}},[s._v("#")]),s._v(" Promise.all")]),s._v(" "),t("ul",[t("li",[s._v("接收一个元素为Promise（若不是，使用"),t("code",[s._v("Promise.resolve")]),s._v("进行转换）的数组。返回也是一个Promise")]),s._v(" "),t("li",[s._v("全部变为成功状态，执行then回调，接收参数为一个数组，即各个Promise元素提供的value。")]),s._v(" "),t("li",[s._v("只要有一个失败，则立即停止Promise.all的执行，并执行catch回调，接收reject提供的reason。")])]),s._v(" "),t("h3",{attrs:{id:"promise-race"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#promise-race"}},[s._v("#")]),s._v(" Promise.race")]),s._v(" "),t("ul",[t("li",[s._v("接收一组promise，但只获取第一个执行完毕的实例的状态")])])])}),[],!1,null,null,null);t.default=e.exports}}]);