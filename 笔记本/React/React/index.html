<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.b533bfa1.css" as="style"><link rel="preload" href="/assets/js/app.300783a1.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.ffcec671.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.61e71969.js" as="script"><link rel="preload" href="/assets/js/page-React.7a18c5e4.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.ec610c62.js" as="script"><link rel="prefetch" href="/assets/js/131.a6f96b35.js"><link rel="prefetch" href="/assets/js/132.31e884be.js"><link rel="prefetch" href="/assets/js/133.bb438d3d.js"><link rel="prefetch" href="/assets/js/layout-Blog.2b88b015.js"><link rel="prefetch" href="/assets/js/layout-Layout.468e5214.js"><link rel="prefetch" href="/assets/js/layout-NotFound.7e9c4145.js"><link rel="prefetch" href="/assets/js/layout-Slide.2e42d835.js"><link rel="prefetch" href="/assets/js/page--026cfd4c.59e2b899.js"><link rel="prefetch" href="/assets/js/page--8016680c.83786bb0.js"><link rel="prefetch" href="/assets/js/page-AOP架构.26a1914d.js"><link rel="prefetch" href="/assets/js/page-BFC.d5428ab7.js"><link rel="prefetch" href="/assets/js/page-CommonJS与ESModule.dd7a67d9.js"><link rel="prefetch" href="/assets/js/page-Cookie、Session、Token.dc50206c.js"><link rel="prefetch" href="/assets/js/page-DNS协议.b68df392.js"><link rel="prefetch" href="/assets/js/page-Diff算法.54a3e291.js"><link rel="prefetch" href="/assets/js/page-ES6有哪些新特性.57318cfc.js"><link rel="prefetch" href="/assets/js/page-EventLoop.59b3b888.js"><link rel="prefetch" href="/assets/js/page-Fiber架构.b57115de.js"><link rel="prefetch" href="/assets/js/page-H5资源加载优化分析.88284a5f.js"><link rel="prefetch" href="/assets/js/page-HTTP2相比于之前版本有哪些提高.a5f33350.js"><link rel="prefetch" href="/assets/js/page-HTTPS的流程.7f72ee6e.js"><link rel="prefetch" href="/assets/js/page-HTTP协议的特点.5a080e31.js"><link rel="prefetch" href="/assets/js/page-HTTP常见状态码.19482787.js"><link rel="prefetch" href="/assets/js/page-HTTP常见请求方法.ba2580b2.js"><link rel="prefetch" href="/assets/js/page-HTTP报文格式.a8976652.js"><link rel="prefetch" href="/assets/js/page-HTTP缓存机制.4b681081.js"><link rel="prefetch" href="/assets/js/page-HomePage.d1e6c9af.js"><link rel="prefetch" href="/assets/js/page-Http接口传输数据的五种方式.6a4569f9.js"><link rel="prefetch" href="/assets/js/page-Koa中间件的原理.c51fff7f.js"><link rel="prefetch" href="/assets/js/page-MVC、MVP、MVVM分别是什么.2cc00f09.js"><link rel="prefetch" href="/assets/js/page-Middleware.275b177e.js"><link rel="prefetch" href="/assets/js/page-NestCli.a5999b0f.js"><link rel="prefetch" href="/assets/js/page-Promise.32728f82.js"><link rel="prefetch" href="/assets/js/page-React理念.a0f4c8a5.js"><link rel="prefetch" href="/assets/js/page-Redux.75dde66a.js"><link rel="prefetch" href="/assets/js/page-Render阶段.29f7ddcb.js"><link rel="prefetch" href="/assets/js/page-Rxjs和Interceptor.045a1059.js"><link rel="prefetch" href="/assets/js/page-SSR.4ccfe04f.js"><link rel="prefetch" href="/assets/js/page-SSR原理与实践.74b01f49.js"><link rel="prefetch" href="/assets/js/page-TCP三握手与四次挥手.c4280e29.js"><link rel="prefetch" href="/assets/js/page-TCP与UDP的区别.fd305d42.js"><link rel="prefetch" href="/assets/js/page-TCP报文的时间戳.9d3635d8.js"><link rel="prefetch" href="/assets/js/page-Template模板编译为真实DOM的过程.ab341c52.js"><link rel="prefetch" href="/assets/js/page-TypeScript.24d708e7.js"><link rel="prefetch" href="/assets/js/page-URI和URL的区别.39186d0b.js"><link rel="prefetch" href="/assets/js/page-V8引擎中一段JS代码的执行流程.839d18d4.js"><link rel="prefetch" href="/assets/js/page-VUE生命周期.5c9985eb.js"><link rel="prefetch" href="/assets/js/page-Vite相关问题.3f6bb87b.js"><link rel="prefetch" href="/assets/js/page-Vue-Router.1806e81c.js"><link rel="prefetch" href="/assets/js/page-Vue-class-component.9edd70b4.js"><link rel="prefetch" href="/assets/js/page-Vue3.2522ae20.js"><link rel="prefetch" href="/assets/js/page-VueObservable.eb352fd5.js"><link rel="prefetch" href="/assets/js/page-VuePress实战.e5bae430.js"><link rel="prefetch" href="/assets/js/page-Vuex.1ccf9ea0.js"><link rel="prefetch" href="/assets/js/page-Vue中的修饰符.f927bf3b.js"><link rel="prefetch" href="/assets/js/page-Vue中的自定义指令.7fc1265f.js"><link rel="prefetch" href="/assets/js/page-Vue和React的区别.0ecd6958.js"><link rel="prefetch" href="/assets/js/page-Vue实现数据响应式的原理.905b0fb0.js"><link rel="prefetch" href="/assets/js/page-WebWorker的使用.f2e164f3.js"><link rel="prefetch" href="/assets/js/page-commit阶段.cc7e4679.js"><link rel="prefetch" href="/assets/js/page-dataMethods作用域问题.d51bf798.js"><link rel="prefetch" href="/assets/js/page-opacity0、visibilityhidden、displaynone的区别.88da48c3.js"><link rel="prefetch" href="/assets/js/page-schedule阶段.7c65e163.js"><link rel="prefetch" href="/assets/js/page-script标签的属性.14dab8aa.js"><link rel="prefetch" href="/assets/js/page-type和interface的异同点.56e36316.js"><link rel="prefetch" href="/assets/js/page-watch和computed的区别.1e89fd00.js"><link rel="prefetch" href="/assets/js/page-webpack.c86daeff.js"><link rel="prefetch" href="/assets/js/page-will-change.626affb0.js"><link rel="prefetch" href="/assets/js/page-一、基本使用.8a266942.js"><link rel="prefetch" href="/assets/js/page-一、起步.37bd5db6.js"><link rel="prefetch" href="/assets/js/page-不同Tab页间的通信.72929a0c.js"><link rel="prefetch" href="/assets/js/page-事件模型.85457357.js"><link rel="prefetch" href="/assets/js/page-从Immutablejs到Redux，起底函数式编程.658e2abd.js"><link rel="prefetch" href="/assets/js/page-从输入URL到页面显示，经历了哪些过程.9f0ce038.js"><link rel="prefetch" href="/assets/js/page-伪类、伪元素.9855e347.js"><link rel="prefetch" href="/assets/js/page-使用Vite从零搭建React项目.1c875443.js"><link rel="prefetch" href="/assets/js/page-修饰器.f2607251.js"><link rel="prefetch" href="/assets/js/page-全局模块和生命周期.64122aa6.js"><link rel="prefetch" href="/assets/js/page-创建版本库.ad3a72a8.js"><link rel="prefetch" href="/assets/js/page-判断元素是否在可视区域内.1fb9304c.js"><link rel="prefetch" href="/assets/js/page-前端数据持久化存储方案.1c7d168d.js"><link rel="prefetch" href="/assets/js/page-前言.9e318bae.js"><link rel="prefetch" href="/assets/js/page-动态Module.6455b220.js"><link rel="prefetch" href="/assets/js/page-动画效果卡顿的解决方案.4f171633.js"><link rel="prefetch" href="/assets/js/page-单位问题.bdee5ade.js"><link rel="prefetch" href="/assets/js/page-原型、继承等相关问题.e73ce111.js"><link rel="prefetch" href="/assets/js/page-各类手写问题汇总.c0ed089b.js"><link rel="prefetch" href="/assets/js/page-垃圾回收问题.5a173351.js"><link rel="prefetch" href="/assets/js/page-基本语法.862406e7.js"><link rel="prefetch" href="/assets/js/page-基础用法.bf003be9.js"><link rel="prefetch" href="/assets/js/page-如何判断页面的性能瓶颈.0520de77.js"><link rel="prefetch" href="/assets/js/page-如何理解Node的单线程.a7948c36.js"><link rel="prefetch" href="/assets/js/page-如何用一键下载B站视频.d3916034.js"><link rel="prefetch" href="/assets/js/page-如何进行权限控制.2610432a.js"><link rel="prefetch" href="/assets/js/page-对于SPA的理解.70c3898e.js"><link rel="prefetch" href="/assets/js/page-对于keep-alive的理解.bf7612ed.js"><link rel="prefetch" href="/assets/js/page-对于前端工程化的理解.c360bb38.js"><link rel="prefetch" href="/assets/js/page-常见HTTP首部字段.4276d18e.js"><link rel="prefetch" href="/assets/js/page-常见网络攻击方式.f35b3b26.js"><link rel="prefetch" href="/assets/js/page-微信小程序底层框架实现原理.b358c303.js"><link rel="prefetch" href="/assets/js/page-微前端.d380c5c4.js"><link rel="prefetch" href="/assets/js/page-控制反转（IOC）与依赖注入（DI）.7956f184.js"><link rel="prefetch" href="/assets/js/page-收藏夹.a5b6d34a.js"><link rel="prefetch" href="/assets/js/page-数据传输相关问题.513c31bf.js"><link rel="prefetch" href="/assets/js/page-数据类型相关问题.f4a41bb2.js"><link rel="prefetch" href="/assets/js/page-最常用的4种居中方法.f71ad05a.js"><link rel="prefetch" href="/assets/js/page-有哪些常见的优化方法.13a638bd.js"><link rel="prefetch" href="/assets/js/page-模块.6439ce2f.js"><link rel="prefetch" href="/assets/js/page-正则表达式.79c39fc4.js"><link rel="prefetch" href="/assets/js/page-注入Provider的多种方式.2d9613f5.js"><link rel="prefetch" href="/assets/js/page-浏览器的多线程.fc94cd5e.js"><link rel="prefetch" href="/assets/js/page-用nodejs实现一个命令行可视化库.37772254.js"><link rel="prefetch" href="/assets/js/page-疑难杂症.3d9589b5.js"><link rel="prefetch" href="/assets/js/page-盒子模型.c0411068.js"><link rel="prefetch" href="/assets/js/page-组件间通信方式有哪些.8c1c5e45.js"><link rel="prefetch" href="/assets/js/page-网络请求方式总结.956db07b.js"><link rel="prefetch" href="/assets/js/page-自适应布局问题.530c6ccf.js"><link rel="prefetch" href="/assets/js/page-虚拟DOM和diff算法.4ebca01c.js"><link rel="prefetch" href="/assets/js/page-虚拟内存.987cdb98.js"><link rel="prefetch" href="/assets/js/page-请求方法.392ba837.js"><link rel="prefetch" href="/assets/js/page-跨域问题.ac2f511d.js"><link rel="prefetch" href="/assets/js/page-进程和线程.1778414a.js"><link rel="prefetch" href="/assets/js/page-重绘、重排、合成.32b56a0e.js"><link rel="prefetch" href="/assets/js/page-针对移动端应用的优化建议.dd508495.js"><link rel="prefetch" href="/assets/js/page-错误捕获.41fc683d.js"><link rel="prefetch" href="/assets/js/page-闭包问题.26a92ec8.js"><link rel="prefetch" href="/assets/js/page-防抖和节流.78327a8e.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.0668bebe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b533bfa1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/author.jpg" alt="" class="logo"> <!----> <!----></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/category/前端/" class="nav-link"><!---->
  前端
</a></div><div class="nav-item"><a href="/category/后端/" class="nav-link"><!---->
  后端
</a></div><div class="nav-item"><a href="/category/计算机网络/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/category/浏览器/" class="nav-link"><!---->
  浏览器
</a></div><div class="nav-item"><a href="/category/操作系统/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/category/其他/" class="nav-link"><!---->
  其他
</a></div><div class="nav-item"><a href="https://github.com/Youky1/Youky1.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/category/前端/" class="nav-link"><!---->
  前端
</a></div><div class="nav-item"><a href="/category/后端/" class="nav-link"><!---->
  后端
</a></div><div class="nav-item"><a href="/category/计算机网络/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/category/浏览器/" class="nav-link"><!---->
  浏览器
</a></div><div class="nav-item"><a href="/category/操作系统/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/category/其他/" class="nav-link"><!---->
  其他
</a></div><div class="nav-item"><a href="https://github.com/Youky1/Youky1.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <!----> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">React</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Youky</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/" data-flag-title="React" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Writing Date📅" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-1-12</span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" defaultAuthor="Youky" tagPath="/tag/$tag/" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">前端</span></span><span aria-label="Tags🏷" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">React</span></li></ul> <meta property="keywords" content="React"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 14 min</span> <meta property="timeRequired" content="PT14M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#jsx" class="anchor-link heading2"><div>JSX</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#组件" class="anchor-link heading2"><div>组件</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#为什么类组件中不执行-super-props-就无法使用-this-props" class="anchor-link heading3"><div>为什么类组件中不执行 super(props)就无法使用 this.props</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#为什么函数组件的-prototype-上挂载属性无效" class="anchor-link heading3"><div>为什么函数组件的 prototype 上挂载属性无效</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#组件间通信方式" class="anchor-link heading3"><div>组件间通信方式</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#state" class="anchor-link heading3"><div>State</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#生命周期" class="anchor-link heading2"><div>生命周期</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#挂载" class="anchor-link heading3"><div>挂载</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#更新" class="anchor-link heading3"><div>更新</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#卸载" class="anchor-link heading3"><div>卸载</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#组合" class="anchor-link heading2"><div>组合</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#memo" class="anchor-link heading2"><div>memo</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#虚拟-dom" class="anchor-link heading2"><div>虚拟 DOM</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#渲染流程" class="anchor-link heading3"><div>渲染流程</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#diff-算法" class="anchor-link heading3"><div>Diff 算法</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#ref" class="anchor-link heading2"><div>ref</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#适用的情况" class="anchor-link heading3"><div>适用的情况</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#ref-赋值的三种方式" class="anchor-link heading3"><div>ref 赋值的三种方式</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#跨层级转发" class="anchor-link heading3"><div>跨层级转发</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#合并转发" class="anchor-link heading3"><div>合并转发</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#执行时机和处理逻辑" class="anchor-link heading3"><div>执行时机和处理逻辑</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#portals" class="anchor-link heading2"><div>Portals</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#事件处理" class="anchor-link heading2"><div>事件处理</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#context" class="anchor-link heading2"><div>Context</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#_1-目的" class="anchor-link heading3"><div>1. 目的</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#_2-使用流程" class="anchor-link heading3"><div>2. 使用流程</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#hooks" class="anchor-link heading2"><div>Hooks</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#usestate" class="anchor-link heading3"><div>useState</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#副作用" class="anchor-link heading3"><div>副作用</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#usecontext" class="anchor-link heading3"><div>useContext</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#usereducer" class="anchor-link heading3"><div>useReducer</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#持久化" class="anchor-link heading3"><div>持久化</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#ref-2" class="anchor-link heading3"><div>Ref</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#自定义-hooks" class="anchor-link heading2"><div>自定义 Hooks</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#样式处理" class="anchor-link heading2"><div>样式处理</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#需要处理的问题" class="anchor-link heading3"><div>需要处理的问题</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#解决思路" class="anchor-link heading3"><div>解决思路</div></a></li><li class="anchor"><a href="/%E7%AC%94%E8%AE%B0%E6%9C%AC/React/React/#css-module" class="anchor-link heading3"><div>CSS Module</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="react"><a href="#react" class="header-anchor">#</a> React</h1> <h2 id="jsx"><a href="#jsx" class="header-anchor">#</a> JSX</h2> <ul><li><p>JSX 表达式有多行时，在外加一对<strong>括号</strong></p></li> <li><p>注释方法：</p> <ul><li>单行：<code>{//注释内容}</code>，其中<code>}</code>必须放在第二行</li> <li>多行：<code>{/**/}</code></li></ul></li> <li><p>插值：用一对括号{}，内部可以使用 JS 表达式</p></li> <li><p>必须包裹在一个最外层容器内。不会被渲染的最外层容器标签：<code>React.Fragment</code>（或使用空标签<code>&lt;&gt;</code>）</p></li> <li><p>自定义元素必须大写开头</p></li> <li><p>特殊属性名替换：</p> <ul><li>设置样式时，<code>calss</code>替换为 <code>className</code></li> <li>label 标签的<code>for</code>替换为<code>htmlFor</code></li></ul></li> <li><p>JSX 实际上是<code>React.createElement(component, props, children)</code>的语法糖，所以老版本中使用 jsx 时必须引入 React</p> <blockquote><p>Babel 插件会提前注入 jsx 相关的 API</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>MyButton color<span class="token operator">=</span><span class="token string">&quot;blue&quot;</span> shadowSize<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  Click Me
<span class="token operator">&lt;</span><span class="token operator">/</span>MyButton<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// 会编译为：</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>MyButton<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">shadowSize</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Click Me&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>组件的 prop 没有赋值则默认值为 true</p></li></ul> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <p>组件的 props 或 state 发生改变时，组件的 render 函数就会重新执行（所有子组件也会）。</p> <h3 id="为什么类组件中不执行-super-props-就无法使用-this-props"><a href="#为什么类组件中不执行-super-props-就无法使用-this-props" class="header-anchor">#</a> 为什么类组件中不执行 super(props)就无法使用 this.props</h3> <p>因为对 props 的挂载是在 <strong>React.Component</strong> 中进行的，在基类中同时还注入了 setState 和 forceUpdate 方法。</p> <h3 id="为什么函数组件的-prototype-上挂载属性无效"><a href="#为什么函数组件的-prototype-上挂载属性无效" class="header-anchor">#</a> 为什么函数组件的 prototype 上挂载属性无效</h3> <p>React 对函数组件的调用是直接执行函数，而不是通过 new。</p> <h3 id="组件间通信方式"><a href="#组件间通信方式" class="header-anchor">#</a> 组件间通信方式</h3> <ol><li>props 与 callback</li> <li>ref 获取元素</li> <li>context</li> <li>Redux 等全局状态</li> <li>eventbus 事件总线</li></ol> <h3 id="state"><a href="#state" class="header-anchor">#</a> State</h3> <h4 id="setstate-和-usestate-的异同"><a href="#setstate-和-usestate-的异同" class="header-anchor">#</a> setState 和 useState 的异同</h4> <p>相同：底层调用的方法相同；都会进行批量更新</p> <p>不同：</p> <ul><li>useState 的更新会对变量进行浅层比较，若相同不会进行更新</li> <li>setState 可以传入回调函数监听更新完成事件（函数组件中通过 useEffect）</li> <li>setState 的逻辑是将传入 state 和老 state 合并。而 useState 的逻辑是重新赋值并覆盖</li></ul> <h4 id="setstate-的批处理模式"><a href="#setstate-的批处理模式" class="header-anchor">#</a> setState 的批处理模式</h4> <p>在 18 版本之后，所有的更新都会使用批处理。</p> <p>在 18 版本之前，会对内部触发的事件监听函数内的 setState 做批处理；对于 <code>addEventListenr</code> 或异步代码则不会。</p> <blockquote><p>原因，是否批处理是通过 <code>isBatchingUpdates</code> 判断的，异步代码切换了函数执行上下文</p></blockquote> <h4 id="强制同步更新-flushsync"><a href="#强制同步更新-flushsync" class="header-anchor">#</a> 强制同步更新：flushSync</h4> <blockquote><p>不推荐使用</p></blockquote> <p>使用 <code>flushSync</code> 将会强制把它接收的函数中的 setState 同步执行，即 DOM 会立即更新。</p> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h3 id="挂载"><a href="#挂载" class="header-anchor">#</a> 挂载</h3> <ol><li><p><code>constructor</code>：</p> <ul><li>类组件的构造函数。必须在开头调用<code>super(props)</code>。</li> <li>构造函数中<strong>不应存在副作用</strong></li></ul></li> <li><p><code>getDerivedStateFromProps</code></p></li></ol> <ul><li>返回一个对象来更新<code>state</code>。若返回 null 则不进行更新</li> <li>仅适用于<code>state</code>的值总取决于<code>props</code>的情况</li></ul> <ol start="3"><li><code>render</code>：</li></ol> <p><strong>必须实现</strong>的方法，应为<strong>纯函数</strong></p> <ol start="4"><li><code>componentDidMount</code></li></ol> <blockquote><p>componentWillMount 已被删除</p></blockquote> <ul><li>会在组件挂载（插入 DOM 树）后马上执行</li> <li>适合进行<strong>依赖于 DOM 的操作</strong></li> <li>适合进行<strong>数据请求</strong></li> <li>在该钩子里调用<code>setState</code>，会触发重新渲染，但用户不会察觉到中间态（即改变数据前第一次 render 的状态）</li></ul> <h3 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h3> <ol><li><p><code>getDerivedStateFromProps</code></p></li> <li><p><code>shouldComponentUpdate(nextProps, nextState)</code></p> <ul><li>根据返回值决定是否更新，默认返回 true</li> <li>调用<code>forceUpdate</code>进行更新时不会调用该方法</li> <li>返回 false 不会阻止子组件在其 state 改变时重新渲染</li></ul></li></ol> <ol start="3"><li><p><code>render</code></p></li> <li><p><code>getSnapshotBeforeUpdte</code></p> <ul><li>在渲染输出之前被调用</li> <li>**意义：**由于渲染是异步的，在<code>rende</code>和<code>componentDidUpdate</code>之间会有延迟，而本钩子可以在 DOM 更新前被调用，读取当前的状态并为<code>componentDidUpdate</code>返回参数</li></ul></li></ol> <ol start="5"><li><p><code>componentDidUpdate(prevProps, prevState)</code></p> <ul><li>在更新完成后立即执行</li> <li>可以对比更新前后的<code>props</code>和<code>state</code></li></ul></li></ol> <h3 id="卸载"><a href="#卸载" class="header-anchor">#</a> 卸载</h3> <ol><li><p><code>componentWillUnmount</code></p> <ul><li>在组件销毁时调用</li> <li>可以进行清理计时器、取消订阅等操作，不应再改变<code>state</code>，因为组件不会再渲染了</li></ul></li></ol> <h2 id="组合"><a href="#组合" class="header-anchor">#</a> 组合</h2> <ul><li><p>通过 props.children 可以取得标签中传入的所有内容。内容不限于可渲染的类型，如可以传递函数</p> <blockquote><p>类似于 vue 中的默认插槽</p></blockquote></li> <li><p>当有多个位置需要预留时，可以通过其他自定义 props 传入</p> <blockquote><p>即将 JSX 对象作为 props 传入</p></blockquote></li></ul> <div class="language-react line-numbers-mode"><pre class="language-text"><code>// 外层组件定义
function OutBox(props){
    return (
    	&lt;div&gt;
        	{props.left}
            {/*
            	一些其他内容
            */}
            {props.right}
        &lt;/div&gt;
    )
}

// 使用时：
&lt;OutBox
	left={&lt;LeftComponent/&gt;}
    right={&lt;RightComponent/&gt;}
/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="memo"><a href="#memo" class="header-anchor">#</a> memo</h2> <ul><li>函数组件不能使用<code>shouldComponentUpdate</code>优化更新流程，可以用<code>React.memo</code>作为替代。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>默认会对<code>props</code>做<strong>浅层比较</strong>，并在<code>props</code>未改变时<strong>复用</strong>组件。若要自定义对比过程，可以传入第二个函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回true表示不更新，返回false表示要更新</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>若函数组件中使用了<code>useState</code>、<code>useEffect</code>、<code>useContext</code>等 Hook，<code>state</code>和<code>context</code>改变时仍会触发更新</li></ul> <h2 id="虚拟-dom"><a href="#虚拟-dom" class="header-anchor">#</a> 虚拟 DOM</h2> <h3 id="渲染流程"><a href="#渲染流程" class="header-anchor">#</a> 渲染流程</h3> <ul><li><p>数据 + JSX 模板生成虚拟 DOM</p> <blockquote><p>虚拟 DOM 是一个 JS 对象</p></blockquote></li> <li><p>用虚拟 DOM 生成真实 DOM</p></li> <li><p>当数据（state 或 props）发生变化时：</p> <ul><li>数据 + 模板生成新的虚拟 DOM</li> <li>和原来的虚拟 DOM 进行比对，找出区别</li> <li>操作 DOM 更新相应内容</li></ul></li></ul> <h3 id="diff-算法"><a href="#diff-算法" class="header-anchor">#</a> Diff 算法</h3> <blockquote><p>比对原来的虚拟 DOM 和新生成的虚拟 DOM 的区别</p></blockquote> <ul><li>是对同层的 DOM 节点的比对
<ul><li>若同层的节点不同，则直接替换其之下的所有节点</li> <li>若相同，则再比较下层的节点</li></ul></li></ul> <h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <blockquote><p>用于获取某个节点元素</p></blockquote> <h3 id="适用的情况"><a href="#适用的情况" class="header-anchor">#</a> 适用的情况</h3> <ul><li>触发强制动画</li> <li>管理焦点</li> <li>文本选择</li> <li>非受控表单（如文件上传）</li></ul> <h3 id="ref-赋值的三种方式"><a href="#ref-赋值的三种方式" class="header-anchor">#</a> ref 赋值的三种方式</h3> <ul><li>使用字符串，把 DOM 或组件实例绑定到<code>this.$refs</code>的同名属性</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>currentDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">&quot;currentDom&quot;</span><span class="token operator">&gt;</span>字符串模式获取元素或组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>使用函数</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>&lt;div ref={(node) =&gt; myRef.current = node } &gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用 ref 对象</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>function Item(){ const myRef = useRef() return
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{myRef}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>MyRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="跨层级转发"><a href="#跨层级转发" class="header-anchor">#</a> 跨层级转发</h3> <p>在 ref 引用的组件中，将 ref 转发到子级组件或 DOM 元素上：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> FancyButton <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>button ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;FancyButton&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用FancyButton组件时直接获取button这个DOM元素的 ref：</span>
<span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>FancyButton ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>FancyButton<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="合并转发"><a href="#合并转发" class="header-anchor">#</a> 合并转发</h3> <p>在转发 ref 时，可以通过赋值的方式将多个 ref 合并到一个对象中</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Demo</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref1 <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref2 <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token punctuation">{</span>
      ref1<span class="token punctuation">,</span>
      ref2
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>ref1<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>ref2<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="执行时机和处理逻辑"><a href="#执行时机和处理逻辑" class="header-anchor">#</a> 执行时机和处理逻辑</h3> <p>对于 ref 的处理都是在更新的<code>commit</code>阶段（实际修改 DOM 的阶段）完成的。</p> <p>对于 ref 会进行两次处理，分别是 DOM 更新前后进行的，也就是说绑定函数的形式，页面更新一次，会执行两次</p> <ul><li>第一次将原来的 ref 置为 null</li></ul> <blockquote><p>卸载时处理也是如此</p></blockquote> <ul><li>第二次是 DOM 更新完之后，为 ref 重新赋值</li></ul> <h2 id="portals"><a href="#portals" class="header-anchor">#</a> Portals</h2> <blockquote><p>提供一种将子组件渲染到父组件 DOM 树之外（任意 DOM 节点）的方案</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ele <span class="token operator">=</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>element<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;ele&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>使用 Portal 返回的节点虽然<strong>不在父组件的 DOM 树中</strong>，但其仍<strong>存在于 React 树中</strong>。</p> <p>因此如<code>context</code>、<code>事件冒泡</code>等特性都是可以使用的。</p> <p>对于 DOM 结构：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app-root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>modal-root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>挂载于<code>app-root</code>的根组件中，可以捕获到<code>modal-root</code>中的事件</p> <h2 id="事件处理"><a href="#事件处理" class="header-anchor">#</a> 事件处理</h2> <ul><li><p>采用驼峰命名</p></li> <li><p>在 JSX 中传入一个函数而不是字符串。<code>onClick={functionName}</code></p></li> <li><p>React 的事件处理只在<code>事件冒泡阶段</code></p></li> <li><p>回调函数接收一个合成事件 e 作为参数</p> <ul><li>要阻止默认事件，不能用<code>return false</code>的方法。要用<code>e.preventDefault</code></li></ul></li> <li><p>在类组件中，回调函数要绑定 this</p> <ul><li><p>在 constructor 中用 bind 方法绑定 this 指向</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>向回调函数传递参数：</p> <ul><li><div class="language- line-numbers-mode"><pre class="language-text"><code>  onClick = {(e) =&gt; this.func(arg,e)}	// 需要手动传入事件参数e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><div class="language- line-numbers-mode"><pre class="language-text"><code>  onClick = {this.func.bind(this,arg)} // e自动传入，作为最后一个参数
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul> <h2 id="context"><a href="#context" class="header-anchor">#</a> Context</h2> <h3 id="_1-目的"><a href="#_1-目的" class="header-anchor">#</a> 1. 目的</h3> <p>在一个组件树中共享全局数据（如主题、颜色等变量），避免在组件之间层层传递 props</p> <h3 id="_2-使用流程"><a href="#_2-使用流程" class="header-anchor">#</a> 2. 使用流程</h3> <h4 id="创建-context-对象"><a href="#创建-context-对象" class="header-anchor">#</a> 创建 Context 对象</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MyContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>只有当 provider 没有提供值时，defaultValue 才起作用</p> <h4 id="使用-context-的-provider-组件"><a href="#使用-context-的-provider-组件" class="header-anchor">#</a> 使用 Context 的 Provider 组件</h4> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token comment">/*某个自定义的值*/</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* 在内部的组件中即可使用MyContext传递来的值 */</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Title</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Provider 接收 value 属性，传递给内部所有组件</li> <li>组件只接收到最近一层的 value。即外层的值会被覆盖</li> <li>当 Provider 的 value 变化时，内部所有使用到 Context 的组件都要重新渲染，并且不受制于<code>shouldComponentUpdate</code></li></ul> <h4 id="使用-contexttype-读取一个-context-类组件"><a href="#使用-contexttype-读取一个-context-类组件" class="header-anchor">#</a> 使用 contextType 读取一个 Context（类组件）</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Title</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">H1</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">H1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等价于</span>
<span class="token keyword">class</span> <span class="token class-name">Title</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">H1</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token constant">H1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Title<span class="token punctuation">.</span>contextType <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><p>在类组件中，将<code>Context对象</code>赋值给类的<code>contextType</code>后，可以通过<code>this.context</code>取得<code>Context对象</code>的值</p></li> <li><p>若要对 context 进行修改，则用 context 传递一个对象，在其中包括要传递的值以及改变它的函数</p></li></ul> <h4 id="创建-consumer-组件读取多个-context"><a href="#创建-consumer-组件读取多个-context" class="header-anchor">#</a> 创建 Consumer 组件读取多个 Context</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">&quot;light&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ColorContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">&quot;white&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> ThemeContext<span class="token punctuation">,</span> ColorContext <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ThemeContext<span class="token punctuation">,</span> ColorContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ColorContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ColorContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ThemeContext<span class="token punctuation">,</span> ColorContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">theme</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>ColorContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
            <span class="token parameter">color</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
              theme is<span class="token operator">:</span> <span class="token punctuation">{</span>theme<span class="token punctuation">}</span>
              color is<span class="token operator">:</span> <span class="token punctuation">{</span>color<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ColorContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="函数组件使用-context"><a href="#函数组件使用-context" class="header-anchor">#</a> 函数组件使用 context</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> time <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span>time<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="三种使用-context-方法的区别"><a href="#三种使用-context-方法的区别" class="header-anchor">#</a> 三种使用 context 方法的区别</h4> <ul><li>A 组件中使用 Consumer 组件消费 context 时，当 context 内容改变，不会导致 A 组件重新渲染</li> <li>其他两种方式，A 组件会重新渲染</li></ul> <h2 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h2> <p><strong>定义</strong>：用于在函数组件中钩入<code>state</code>和<code>生命周期</code>的**<em>函数</em>**</p> <p><strong>调用规则：</strong></p> <ul><li>只能在函数最外层调用，不能在循环语句、条件判断、子函数中使用</li> <li>只能在<strong>函数组件</strong>和<strong>自定义 Hook</strong>中调用</li> <li>需要从 react 中引入</li></ul> <h3 id="usestate"><a href="#usestate" class="header-anchor">#</a> useState</h3> <p><strong>目的</strong>：在函数组件中使用<code>state</code></p> <p><strong>用法</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>useState</code>返回一个数组，两个元素分别是状态值（<code>state</code>），和改变这个状态的函数（<code>setState</code>）
<ul><li>此处的 state<strong>不一定</strong>是一个对象，可以是任意类型的</li> <li>返回的更新函数不会将新旧值合并，而是<strong>直接替代</strong></li></ul></li> <li><code>useState</code>接收一个参数，作为状态的默认值</li> <li><strong>惰性初始化</strong>：该参数也可以是一个函数，返回默认值。该函数只会在初次加载时执行</li> <li>同一组件内，可以多次调用<code>useState</code></li></ul> <h3 id="副作用"><a href="#副作用" class="header-anchor">#</a> 副作用</h3> <h4 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> useEffect</h4> <p><strong>目的</strong>：</p> <ul><li>执行副作用操作，可以作为 <code>componentDidMount</code>，<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 三个函数的组合。</li> <li>实现关注点分离。将不相关的行为拆分到不同的 useEffect 中，而不是杂糅到同一个声明周期钩子里</li></ul> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行异步操作</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 返回清除函数</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>第一个参数是<strong>函数</strong>（effect），初次渲染（<code>componentDidMount</code>）以及更新（<code>componentDidUpdate</code> ）时执行。</li> <li>第二个参数是一个<strong>数组</strong>。默认情况下每次渲染 effect 都会调用。传入第二个数组后，若数组中所有元素在渲染前后都相等（===），则会跳过此次 effect 的执行。<strong>传入空数组，即只执行一次</strong></li> <li>返回一个函数（可选），会在<strong>组件卸载时</strong>（<code>componentWillUnmount</code>）执行。</li> <li><strong>执行时机</strong>：DOM 更新完成，<strong>浏览器渲染之后</strong></li> <li>和生命周期函数的区别：<strong>异步执行</strong>，不会阻塞浏览器绘制</li></ul> <h4 id="uselayouteffect"><a href="#uselayouteffect" class="header-anchor">#</a> useLayoutEffect</h4> <blockquote><p>需要在副作用中修改 DOM，就用 <code>useLayoutEffect</code> ，否则用<code>useEffect</code></p></blockquote> <p>用法和 useEffect 相同。</p> <p>区别在于：</p> <ul><li>会同步执行（会造成阻塞）</li> <li><strong>执行时机</strong>：DOM 更新完成，<strong>浏览器渲染之前</strong></li></ul> <h4 id="useinsertioneffect"><a href="#useinsertioneffect" class="header-anchor">#</a> useInsertionEffect</h4> <p>执行时机：DOM 更新之前。</p> <p>使用场景：仅建议<code>css in JS</code>库的开发中使用，解决注入样式的性能问题。</p> <p><code>css in JS</code>库的原理是动态生成选择器，并通过 style 标签插入。如果在 <code>useLayoutEffect</code> 或<code>useEffect</code>中进行操作，DOM 已经更新完毕，插入 style 会造成重绘和重排</p> <h3 id="usecontext"><a href="#usecontext" class="header-anchor">#</a> useContext</h3> <p>**目的：**在函数组件中读取<code>Context对象</code>的值</p> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 相当于类组件中的</span>
<span class="token keyword">static</span> contextType <span class="token operator">=</span> MyContext
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>接收的是<strong>Context 对象本身</strong></li> <li>返回的是<strong>Context 对象的当前值</strong></li> <li>当<code>MyContext.Provider</code>提供的值更新时，该 hook 会触发重新渲染（即使父组件通过<code>shouldComponentUpdate</code>跳过了更新）</li></ul> <h3 id="usereducer"><a href="#usereducer" class="header-anchor">#</a> useReducer</h3> <p><strong>目的：</strong></p> <ul><li><code>useReducer</code>是用来以类似 redux 的逻辑（数据作为 state，改变数据通过 reducer）处理组件内的复杂<code>state</code></li> <li><code>useReducer</code>并<strong>不负责组件间共享</strong>，可以配合<code>useContext</code>使用实现共享</li></ul> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;change&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...和redux一样，复制一份state并做修改，最后返回</span>
    <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">initFunction</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> val<span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用state中的数据，使用dispatch提交更改</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> defaultState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 惰性初始化</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> defaultState<span class="token punctuation">,</span> initFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li><p><code>useReducer</code>接收三个参数</p> <ul><li><code>reducer</code>函数</li> <li><code>state</code>默认值</li> <li>惰性初始化函数：将 state 初始化的逻辑抽离为一个函数，会接受第二个参数作为函数的参数，并返回 state 的默认值</li></ul></li> <li><p>若需要在其他组件中触发变更，则将<code>dispatch</code>函数通过<code>props</code>或<code>Context</code>传递给子组件</p></li></ul> <h3 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h3> <h4 id="usecallback"><a href="#usecallback" class="header-anchor">#</a> useCallback</h4> <p>**目的：**返回一个<code>memoized函数</code></p> <blockquote><p>即依赖的数据不变时，函数（的引用）不变</p></blockquote> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>第一个参数是需要记忆的函数</li> <li>第二个参数是数组，应列出函数所依赖的所有变量，这些变量<strong>不会传递给函数作为参数</strong></li> <li>若没有提供依赖数组，则每次都重新计算</li></ul> <h4 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h4> <p>**目的：**返回一个<code>memoized值</code></p> <blockquote><p>依赖的数据不变，不会重新进行计算，值也不变</p></blockquote> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> memoValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something...</span>
  <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>两个参数的含义和<code>useCallback</code>一样</li> <li>若没有提供依赖数组，则每次都重新计算</li></ul> <h3 id="ref-2"><a href="#ref-2" class="header-anchor">#</a> Ref</h3> <h4 id="useref"><a href="#useref" class="header-anchor">#</a> useRef</h4> <p><strong>目的：</strong></p> <ul><li>返回一个可变的 ref 对象，其 current 属性用于存储变量（可以是对于 DOM 的引用，或其他任何值）</li></ul> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>renderIndex<span class="token punctuation">,</span> setRenderIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref1 <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ref2 <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ref1<span class="token punctuation">.</span>current<span class="token punctuation">,</span> ref2<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null &lt;h2&gt;xxx&lt;/h2&gt;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1 ref<span class="token operator">=</span><span class="token punctuation">{</span>ref1<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>renderIndex<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2 ref<span class="token operator">=</span><span class="token punctuation">{</span>ref2<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>renderIndex<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setRenderIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Cause re<span class="token operator">-</span>render
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>和<code>createRef</code>的区别：</p> <ul><li><p>存储 DOM 节点并在回调中引用时，和<code>createRef</code>基本一致（除了在函数顶层直接使用）</p> <ul><li><code>createRef</code>每次都会重新执行并赋值</li> <li>而<code>useRef</code>返回的始终是同一个引用</li></ul></li> <li><p>可以用于存储<strong>与渲染无关但后续会改变的值</strong>，因为<code>useRef</code>返回的变量改变后，<strong>不会触发</strong>重新渲染</p> <ul><li>由于**<code>createRef</code>每次都返回新的引用**，所以无法保存原来的状态。所以点击按钮后，h1 标签中仍未空</li> <li><code>useRef</code>每次返回同一个引用，点击按钮对其赋值后，h2 标签中的内容会改变</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> createRefValue <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> useRefValue <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> setDummyState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span>createRefValue<span class="token punctuation">.</span>current<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>useRefValue<span class="token punctuation">.</span>current<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          createRefValue<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
          useRefValue<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
          <span class="token function">setDummyState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        Set Value
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>可以用于在更新时保存上一次的状态：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prevCountRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    prevCountRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>
        <span class="token literal-property property">Now</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">before</span><span class="token operator">:</span> <span class="token punctuation">{</span>prevCountRef<span class="token punctuation">.</span>current<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 或是抽取为一个自定义Hooks</span>
<span class="token keyword">function</span> <span class="token function">usePre</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用：</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> prevCountRef <span class="token operator">=</span> <span class="token function">usePre</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li></ul> <h4 id="useimperativehandle"><a href="#useimperativehandle" class="header-anchor">#</a> useImperativeHandle</h4> <p>**目的：**自定义<code>ref</code>给父组件暴露的内容，即暴露某些可操作方法，而不是直接暴露引用</p> <p><strong>用法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Input</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">focus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">...</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> FancyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>Input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> myRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
    	<span class="token operator">&lt;</span>FancyInput ref<span class="token operator">=</span><span class="token punctuation">{</span>myRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>配合<code>React.forwardRef</code>使用</li> <li>第一个参数是<code>ref</code>（从<code>forwardRef</code>包装的组件函数中接收的第二个参数）</li> <li>第二个参数是一个函数，返回一个对象，这个对象会赋值给<code>ref.current</code></li></ul> <h2 id="自定义-hooks"><a href="#自定义-hooks" class="header-anchor">#</a> 自定义 Hooks</h2> <blockquote><p>将组件逻辑提取到可复用的函数中</p></blockquote> <ul><li>定义一个函数（<strong>必须以 useXxx 形式命名</strong>）</li> <li>在函数内调用其他 Hooks 函数</li> <li>可以在自定义 Hooks 中接收任意参数，返回任意值</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">usePre</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="样式处理"><a href="#样式处理" class="header-anchor">#</a> 样式处理</h2> <h3 id="需要处理的问题"><a href="#需要处理的问题" class="header-anchor">#</a> 需要处理的问题</h3> <p>CSS 没有全局作用域，会带来<strong>全局污染</strong>、<strong>命名冲突</strong>的问题</p> <h3 id="解决思路"><a href="#解决思路" class="header-anchor">#</a> 解决思路</h3> <ol><li><code>CSS in JS</code>： 如<code>styled-components</code></li> <li><code>CSS Module</code></li></ol> <h3 id="css-module"><a href="#css-module" class="header-anchor">#</a> CSS Module</h3> <blockquote><p><strong><em>CSS Module 仅处理类选择器</em></strong></p></blockquote> <p>在最新版的<code>create-react-app</code>创建的项目中，已经自带了对于<code>CSS Module</code>的支持</p> <h4 id="局部样式"><a href="#局部样式" class="header-anchor">#</a> 局部样式</h4> <ol><li>对于局部样式，命名时使用<code>xxx.module.css</code>的格式</li> <li>在引入样式时，引入一个对象的形式，并用它的属性进行赋值</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&quot;./index.module.css&quot;</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="全局样式"><a href="#全局样式" class="header-anchor">#</a> 全局样式</h4> <ul><li>使用传统的命名方法并直接引入</li> <li>在<code>xxx.module.css</code>中，使用<code>:global()</code>语法</li></ul> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">:global(.title)</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> redl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">April 11, 2023 10:01</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 1911303982@qq.com" class="contributor">
          Youky
        </span> , <span title="email: 1911303982@qq.com" class="contributor">
          youky7
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.300783a1.js" defer></script><script src="/assets/js/vendors~layout-Layout.ffcec671.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.61e71969.js" defer></script><script src="/assets/js/page-React.7a18c5e4.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.ec610c62.js" defer></script>
  </body>
</html>
