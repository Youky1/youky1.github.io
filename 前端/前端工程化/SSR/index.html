<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SSR 原理与实践</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.b533bfa1.css" as="style"><link rel="preload" href="/assets/js/app.300783a1.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.ffcec671.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.61e71969.js" as="script"><link rel="preload" href="/assets/js/page-SSR原理与实践.74b01f49.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.ec610c62.js" as="script"><link rel="prefetch" href="/assets/js/131.a6f96b35.js"><link rel="prefetch" href="/assets/js/132.31e884be.js"><link rel="prefetch" href="/assets/js/133.bb438d3d.js"><link rel="prefetch" href="/assets/js/layout-Blog.2b88b015.js"><link rel="prefetch" href="/assets/js/layout-Layout.468e5214.js"><link rel="prefetch" href="/assets/js/layout-NotFound.7e9c4145.js"><link rel="prefetch" href="/assets/js/layout-Slide.2e42d835.js"><link rel="prefetch" href="/assets/js/page--026cfd4c.59e2b899.js"><link rel="prefetch" href="/assets/js/page--8016680c.83786bb0.js"><link rel="prefetch" href="/assets/js/page-AOP架构.26a1914d.js"><link rel="prefetch" href="/assets/js/page-BFC.d5428ab7.js"><link rel="prefetch" href="/assets/js/page-CommonJS与ESModule.dd7a67d9.js"><link rel="prefetch" href="/assets/js/page-Cookie、Session、Token.dc50206c.js"><link rel="prefetch" href="/assets/js/page-DNS协议.b68df392.js"><link rel="prefetch" href="/assets/js/page-Diff算法.54a3e291.js"><link rel="prefetch" href="/assets/js/page-ES6有哪些新特性.57318cfc.js"><link rel="prefetch" href="/assets/js/page-EventLoop.59b3b888.js"><link rel="prefetch" href="/assets/js/page-Fiber架构.b57115de.js"><link rel="prefetch" href="/assets/js/page-H5资源加载优化分析.88284a5f.js"><link rel="prefetch" href="/assets/js/page-HTTP2相比于之前版本有哪些提高.a5f33350.js"><link rel="prefetch" href="/assets/js/page-HTTPS的流程.7f72ee6e.js"><link rel="prefetch" href="/assets/js/page-HTTP协议的特点.5a080e31.js"><link rel="prefetch" href="/assets/js/page-HTTP常见状态码.19482787.js"><link rel="prefetch" href="/assets/js/page-HTTP常见请求方法.ba2580b2.js"><link rel="prefetch" href="/assets/js/page-HTTP报文格式.a8976652.js"><link rel="prefetch" href="/assets/js/page-HTTP缓存机制.4b681081.js"><link rel="prefetch" href="/assets/js/page-HomePage.d1e6c9af.js"><link rel="prefetch" href="/assets/js/page-Http接口传输数据的五种方式.6a4569f9.js"><link rel="prefetch" href="/assets/js/page-Koa中间件的原理.c51fff7f.js"><link rel="prefetch" href="/assets/js/page-MVC、MVP、MVVM分别是什么.2cc00f09.js"><link rel="prefetch" href="/assets/js/page-Middleware.275b177e.js"><link rel="prefetch" href="/assets/js/page-NestCli.a5999b0f.js"><link rel="prefetch" href="/assets/js/page-Promise.32728f82.js"><link rel="prefetch" href="/assets/js/page-React.7a18c5e4.js"><link rel="prefetch" href="/assets/js/page-React理念.a0f4c8a5.js"><link rel="prefetch" href="/assets/js/page-Redux.75dde66a.js"><link rel="prefetch" href="/assets/js/page-Render阶段.29f7ddcb.js"><link rel="prefetch" href="/assets/js/page-Rxjs和Interceptor.045a1059.js"><link rel="prefetch" href="/assets/js/page-SSR.4ccfe04f.js"><link rel="prefetch" href="/assets/js/page-TCP三握手与四次挥手.c4280e29.js"><link rel="prefetch" href="/assets/js/page-TCP与UDP的区别.fd305d42.js"><link rel="prefetch" href="/assets/js/page-TCP报文的时间戳.9d3635d8.js"><link rel="prefetch" href="/assets/js/page-Template模板编译为真实DOM的过程.ab341c52.js"><link rel="prefetch" href="/assets/js/page-TypeScript.24d708e7.js"><link rel="prefetch" href="/assets/js/page-URI和URL的区别.39186d0b.js"><link rel="prefetch" href="/assets/js/page-V8引擎中一段JS代码的执行流程.839d18d4.js"><link rel="prefetch" href="/assets/js/page-VUE生命周期.5c9985eb.js"><link rel="prefetch" href="/assets/js/page-Vite相关问题.3f6bb87b.js"><link rel="prefetch" href="/assets/js/page-Vue-Router.1806e81c.js"><link rel="prefetch" href="/assets/js/page-Vue-class-component.9edd70b4.js"><link rel="prefetch" href="/assets/js/page-Vue3.2522ae20.js"><link rel="prefetch" href="/assets/js/page-VueObservable.eb352fd5.js"><link rel="prefetch" href="/assets/js/page-VuePress实战.e5bae430.js"><link rel="prefetch" href="/assets/js/page-Vuex.1ccf9ea0.js"><link rel="prefetch" href="/assets/js/page-Vue中的修饰符.f927bf3b.js"><link rel="prefetch" href="/assets/js/page-Vue中的自定义指令.7fc1265f.js"><link rel="prefetch" href="/assets/js/page-Vue和React的区别.0ecd6958.js"><link rel="prefetch" href="/assets/js/page-Vue实现数据响应式的原理.905b0fb0.js"><link rel="prefetch" href="/assets/js/page-WebWorker的使用.f2e164f3.js"><link rel="prefetch" href="/assets/js/page-commit阶段.cc7e4679.js"><link rel="prefetch" href="/assets/js/page-dataMethods作用域问题.d51bf798.js"><link rel="prefetch" href="/assets/js/page-opacity0、visibilityhidden、displaynone的区别.88da48c3.js"><link rel="prefetch" href="/assets/js/page-schedule阶段.7c65e163.js"><link rel="prefetch" href="/assets/js/page-script标签的属性.14dab8aa.js"><link rel="prefetch" href="/assets/js/page-type和interface的异同点.56e36316.js"><link rel="prefetch" href="/assets/js/page-watch和computed的区别.1e89fd00.js"><link rel="prefetch" href="/assets/js/page-webpack.c86daeff.js"><link rel="prefetch" href="/assets/js/page-will-change.626affb0.js"><link rel="prefetch" href="/assets/js/page-一、基本使用.8a266942.js"><link rel="prefetch" href="/assets/js/page-一、起步.37bd5db6.js"><link rel="prefetch" href="/assets/js/page-不同Tab页间的通信.72929a0c.js"><link rel="prefetch" href="/assets/js/page-事件模型.85457357.js"><link rel="prefetch" href="/assets/js/page-从Immutablejs到Redux，起底函数式编程.658e2abd.js"><link rel="prefetch" href="/assets/js/page-从输入URL到页面显示，经历了哪些过程.9f0ce038.js"><link rel="prefetch" href="/assets/js/page-伪类、伪元素.9855e347.js"><link rel="prefetch" href="/assets/js/page-使用Vite从零搭建React项目.1c875443.js"><link rel="prefetch" href="/assets/js/page-修饰器.f2607251.js"><link rel="prefetch" href="/assets/js/page-全局模块和生命周期.64122aa6.js"><link rel="prefetch" href="/assets/js/page-创建版本库.ad3a72a8.js"><link rel="prefetch" href="/assets/js/page-判断元素是否在可视区域内.1fb9304c.js"><link rel="prefetch" href="/assets/js/page-前端数据持久化存储方案.1c7d168d.js"><link rel="prefetch" href="/assets/js/page-前言.9e318bae.js"><link rel="prefetch" href="/assets/js/page-动态Module.6455b220.js"><link rel="prefetch" href="/assets/js/page-动画效果卡顿的解决方案.4f171633.js"><link rel="prefetch" href="/assets/js/page-单位问题.bdee5ade.js"><link rel="prefetch" href="/assets/js/page-原型、继承等相关问题.e73ce111.js"><link rel="prefetch" href="/assets/js/page-各类手写问题汇总.c0ed089b.js"><link rel="prefetch" href="/assets/js/page-垃圾回收问题.5a173351.js"><link rel="prefetch" href="/assets/js/page-基本语法.862406e7.js"><link rel="prefetch" href="/assets/js/page-基础用法.bf003be9.js"><link rel="prefetch" href="/assets/js/page-如何判断页面的性能瓶颈.0520de77.js"><link rel="prefetch" href="/assets/js/page-如何理解Node的单线程.a7948c36.js"><link rel="prefetch" href="/assets/js/page-如何用一键下载B站视频.d3916034.js"><link rel="prefetch" href="/assets/js/page-如何进行权限控制.2610432a.js"><link rel="prefetch" href="/assets/js/page-对于SPA的理解.70c3898e.js"><link rel="prefetch" href="/assets/js/page-对于keep-alive的理解.bf7612ed.js"><link rel="prefetch" href="/assets/js/page-对于前端工程化的理解.c360bb38.js"><link rel="prefetch" href="/assets/js/page-常见HTTP首部字段.4276d18e.js"><link rel="prefetch" href="/assets/js/page-常见网络攻击方式.f35b3b26.js"><link rel="prefetch" href="/assets/js/page-微信小程序底层框架实现原理.b358c303.js"><link rel="prefetch" href="/assets/js/page-微前端.d380c5c4.js"><link rel="prefetch" href="/assets/js/page-控制反转（IOC）与依赖注入（DI）.7956f184.js"><link rel="prefetch" href="/assets/js/page-收藏夹.a5b6d34a.js"><link rel="prefetch" href="/assets/js/page-数据传输相关问题.513c31bf.js"><link rel="prefetch" href="/assets/js/page-数据类型相关问题.f4a41bb2.js"><link rel="prefetch" href="/assets/js/page-最常用的4种居中方法.f71ad05a.js"><link rel="prefetch" href="/assets/js/page-有哪些常见的优化方法.13a638bd.js"><link rel="prefetch" href="/assets/js/page-模块.6439ce2f.js"><link rel="prefetch" href="/assets/js/page-正则表达式.79c39fc4.js"><link rel="prefetch" href="/assets/js/page-注入Provider的多种方式.2d9613f5.js"><link rel="prefetch" href="/assets/js/page-浏览器的多线程.fc94cd5e.js"><link rel="prefetch" href="/assets/js/page-用nodejs实现一个命令行可视化库.37772254.js"><link rel="prefetch" href="/assets/js/page-疑难杂症.3d9589b5.js"><link rel="prefetch" href="/assets/js/page-盒子模型.c0411068.js"><link rel="prefetch" href="/assets/js/page-组件间通信方式有哪些.8c1c5e45.js"><link rel="prefetch" href="/assets/js/page-网络请求方式总结.956db07b.js"><link rel="prefetch" href="/assets/js/page-自适应布局问题.530c6ccf.js"><link rel="prefetch" href="/assets/js/page-虚拟DOM和diff算法.4ebca01c.js"><link rel="prefetch" href="/assets/js/page-虚拟内存.987cdb98.js"><link rel="prefetch" href="/assets/js/page-请求方法.392ba837.js"><link rel="prefetch" href="/assets/js/page-跨域问题.ac2f511d.js"><link rel="prefetch" href="/assets/js/page-进程和线程.1778414a.js"><link rel="prefetch" href="/assets/js/page-重绘、重排、合成.32b56a0e.js"><link rel="prefetch" href="/assets/js/page-针对移动端应用的优化建议.dd508495.js"><link rel="prefetch" href="/assets/js/page-错误捕获.41fc683d.js"><link rel="prefetch" href="/assets/js/page-闭包问题.26a92ec8.js"><link rel="prefetch" href="/assets/js/page-防抖和节流.78327a8e.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.0668bebe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b533bfa1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/author.jpg" alt="" class="logo"> <!----> <!----></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/category/前端/" class="nav-link"><!---->
  前端
</a></div><div class="nav-item"><a href="/category/后端/" class="nav-link"><!---->
  后端
</a></div><div class="nav-item"><a href="/category/计算机网络/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/category/浏览器/" class="nav-link"><!---->
  浏览器
</a></div><div class="nav-item"><a href="/category/操作系统/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/category/其他/" class="nav-link"><!---->
  其他
</a></div><div class="nav-item"><a href="https://github.com/Youky1/Youky1.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/category/前端/" class="nav-link"><!---->
  前端
</a></div><div class="nav-item"><a href="/category/后端/" class="nav-link"><!---->
  后端
</a></div><div class="nav-item"><a href="/category/计算机网络/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/category/浏览器/" class="nav-link"><!---->
  浏览器
</a></div><div class="nav-item"><a href="/category/操作系统/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/category/其他/" class="nav-link"><!---->
  其他
</a></div><div class="nav-item"><a href="https://github.com/Youky1/Youky1.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">TS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">前端工程化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/" class="sidebar-link">CommonJS 与 ES Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#模块化方案要解决的问题" class="sidebar-link">模块化方案要解决的问题</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#commonjs" class="sidebar-link">CommonJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#导出" class="sidebar-link heading3">导出</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#导入" class="sidebar-link heading3">导入</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#缓存机制" class="sidebar-link heading3">缓存机制</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#es-module" class="sidebar-link">ES Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#导出-2" class="sidebar-link heading3">导出</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#导入-2" class="sidebar-link heading3">导入</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#二者区别" class="sidebar-link">二者区别</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/CommonJS%E5%92%8CESModule%E7%9A%84%E5%8C%BA%E5%88%AB/#为什么开发中两种方式可以混用" class="sidebar-link">为什么开发中两种方式可以混用</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/" aria-current="page" class="active sidebar-link">SSR 原理与实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#背景" class="sidebar-link">背景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端渲染方式的发展历程" class="sidebar-link heading3">前端渲染方式的发展历程</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#各阶段的优缺点对比" class="sidebar-link heading3">各阶段的优缺点对比</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#为什么需要同构-ssr" class="sidebar-link heading3">为什么需要同构 SSR</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#实现原理" class="sidebar-link">实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#将-react-组件转换为-html-字符串" class="sidebar-link heading3">将 React 组件转换为 HTML 字符串</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#流式渲染" class="sidebar-link heading3">流式渲染</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#路由同构" class="sidebar-link">路由同构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#路由定义" class="sidebar-link heading3">路由定义</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#后端部分" class="sidebar-link heading3">后端部分</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端部分" class="sidebar-link heading3">前端部分</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据同构" class="sidebar-link">数据同构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#后端实现" class="sidebar-link heading3">后端实现</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端实现" class="sidebar-link heading3">前端实现</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据脱水" class="sidebar-link heading3">数据脱水</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据注水" class="sidebar-link heading3">数据注水</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#完善-tdk-信息" class="sidebar-link heading3">完善 TDK 信息</a></li></ul></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" class="sidebar-link">Vite 相关问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/#vite-的流程和-webpack-的区别" class="sidebar-link">Vite 的流程和 Webpack 的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/#webpack" class="sidebar-link heading3">Webpack</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/#vite" class="sidebar-link heading3">Vite</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/#和-webpack-相比-优缺点是什么" class="sidebar-link">和 Webpack 相比，优缺点是什么</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vite%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/#为什么-esbuild-更快" class="sidebar-link">为什么 esbuild 更快？</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/" class="sidebar-link">Vue 和 React 的区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/#模板渲染的方式不同" class="sidebar-link">模板渲染的方式不同</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/#监听数据变化的设计思想不一样" class="sidebar-link">监听数据变化的设计思想不一样</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/#数据变化时的渲染过程不同" class="sidebar-link">数据变化时的渲染过程不同</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/#组件间通信方式的不同" class="sidebar-link">组件间通信方式的不同</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Vue%E5%92%8CReact%E7%9A%84%E5%8C%BA%E5%88%AB/#生态的不同" class="sidebar-link">生态的不同</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/" class="sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_0-webpack-解决了什么问题" class="sidebar-link">0. webpack 解决了什么问题</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_1-模块化的演进过程" class="sidebar-link">1. 模块化的演进过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#第一阶段、文件划分" class="sidebar-link heading3">第一阶段、文件划分</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#第二阶段、命名空间方式" class="sidebar-link heading3">第二阶段、命名空间方式</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#第三阶段、iife" class="sidebar-link heading3">第三阶段、IIFE</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_2-核心概念" class="sidebar-link">2. 核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#entry" class="sidebar-link heading3">entry</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#output" class="sidebar-link heading3">output</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#mode" class="sidebar-link heading3">mode</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#loader" class="sidebar-link heading3">loader</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#plugin" class="sidebar-link heading3">plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#loader-和-plugin-的区别" class="sidebar-link heading3">loader 和 plugin 的区别</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#编写-loader-和-plugin-的思路" class="sidebar-link heading3">编写 loader 和 plugin 的思路</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_3-常见文件的解析" class="sidebar-link">3. 常见文件的解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#es6" class="sidebar-link heading3">ES6</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#样式" class="sidebar-link heading3">样式</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#图片-字体" class="sidebar-link heading3">图片 / 字体</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_4-文件监听" class="sidebar-link">4. 文件监听</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#原理" class="sidebar-link heading3">原理</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#配置" class="sidebar-link heading3">配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_5-webpack-dev-server" class="sidebar-link">5. webpack-dev-server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#使用" class="sidebar-link heading3">使用</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#静态资源访问" class="sidebar-link heading3">静态资源访问</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#proxy-代理" class="sidebar-link heading3">Proxy 代理</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#热更新" class="sidebar-link heading3">热更新</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_6-文件指纹" class="sidebar-link">6. 文件指纹</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_7-页面公共资源的分离" class="sidebar-link">7. 页面公共资源的分离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#基础库分离-cdn-形式引入" class="sidebar-link heading3">基础库分离（CDN 形式引入）</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#提取公共资源" class="sidebar-link heading3">提取公共资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_8-tree-shaking" class="sidebar-link">8. Tree Shaking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#使用-babel-loader-后失效的问题" class="sidebar-link heading3">使用 babel-loader 后失效的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_9-sideeffects" class="sidebar-link">9. SideEffects</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_10-sourcemap" class="sidebar-link">10. SourceMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#eval" class="sidebar-link heading3">eval</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#eval-source-map" class="sidebar-link heading3">eval-source-map</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#cheap-eval-source-map" class="sidebar-link heading3">cheap-eval-source-map</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#cheap-module-eval-source-map" class="sidebar-link heading3">cheap-module-eval-source-map</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#nosources-source-map" class="sidebar-link heading3">nosources-source-map</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#总结" class="sidebar-link heading3">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_11-code-splitting-分块打包" class="sidebar-link">11. Code Splitting（分块打包）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#分包的原因" class="sidebar-link heading3">分包的原因</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#多入口打包" class="sidebar-link heading3">多入口打包</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#动态导入" class="sidebar-link heading3">动态导入</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_12-scope-hoisting" class="sidebar-link">12. Scope hoisting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#要解决的问题" class="sidebar-link heading3">要解决的问题</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#原理-2" class="sidebar-link heading3">原理</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#使用-3" class="sidebar-link heading3">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_13-打包基础库" class="sidebar-link">13. 打包基础库</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_14-构建过程分析" class="sidebar-link">14. 构建过程分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#初级分析-内置的-stats" class="sidebar-link heading3">初级分析：内置的 stats</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#速度分析-speed-measure-webpack-plugin" class="sidebar-link heading3">速度分析：speed-measure-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#体积分析-webpack-bundle-analyzer" class="sidebar-link heading3">体积分析：webpack-bundle-analyzer</a></li></ul></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#_15-构建优化" class="sidebar-link">15. 构建优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#多进程并行构建-thread-loader" class="sidebar-link heading3">多进程并行构建：thread-loader</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#多进程并行压缩-terserwebpackplugin" class="sidebar-link heading3">多进程并行压缩：TerserWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#利用缓存-提升二次构建速度" class="sidebar-link heading3">利用缓存：提升二次构建速度</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/#优化查找策略" class="sidebar-link heading3">优化查找策略</a></li></ul></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%B9%BE%E5%9D%A4%E5%AE%9E%E7%8E%B0%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86/" class="sidebar-link">微前端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%B9%BE%E5%9D%A4%E5%AE%9E%E7%8E%B0%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86/#微前端和iframe的优劣对比" class="sidebar-link">微前端和iframe的优劣对比</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%B9%BE%E5%9D%A4%E5%AE%9E%E7%8E%B0%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86/#qiankun的沙箱隔离机制" class="sidebar-link">qiankun的沙箱隔离机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%B9%BE%E5%9D%A4%E5%AE%9E%E7%8E%B0%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86/#样式隔离" class="sidebar-link heading3">样式隔离</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%B9%BE%E5%9D%A4%E5%AE%9E%E7%8E%B0%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8E%9F%E7%90%86/#js-沙箱" class="sidebar-link heading3">JS 沙箱</a></li></ul></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%AF%B9%E4%BA%8E%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E7%90%86%E8%A7%A3/" class="sidebar-link">对于前端工程化的理解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%AF%B9%E4%BA%8E%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E7%90%86%E8%A7%A3/#模块化" class="sidebar-link">模块化</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%AF%B9%E4%BA%8E%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E7%90%86%E8%A7%A3/#组件化" class="sidebar-link">组件化</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%AF%B9%E4%BA%8E%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E7%90%86%E8%A7%A3/#规范化" class="sidebar-link">规范化</a></li><li class="sidebar-sub-header"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E5%AF%B9%E4%BA%8E%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E7%9A%84%E7%90%86%E8%A7%A3/#自动化" class="sidebar-link">自动化</a></li></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E9%92%88%E5%AF%B9%E7%A7%BB%E5%8A%A8%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9A%84%E4%BC%98%E5%8C%96/" class="sidebar-link">针对移动端应用的优化建议</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">微信小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">性能优化问题</span> <span class="arrow right"></span></p> <!----></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">SSR 原理与实践</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Youky</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/" data-flag-title="SSR 原理与实践" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Writing Date📅" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2024-5-7</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="Youky" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 8 min</span> <meta property="timeRequired" content="PT8M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#背景" class="anchor-link heading2"><div>背景</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端渲染方式的发展历程" class="anchor-link heading3"><div>前端渲染方式的发展历程</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#各阶段的优缺点对比" class="anchor-link heading3"><div>各阶段的优缺点对比</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#为什么需要同构-ssr" class="anchor-link heading3"><div>为什么需要同构 SSR</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#实现原理" class="anchor-link heading2"><div>实现原理</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#将-react-组件转换为-html-字符串" class="anchor-link heading3"><div>将 React 组件转换为 HTML 字符串</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#流式渲染" class="anchor-link heading3"><div>流式渲染</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#路由同构" class="anchor-link heading2"><div>路由同构</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#路由定义" class="anchor-link heading3"><div>路由定义</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#后端部分" class="anchor-link heading3"><div>后端部分</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端部分" class="anchor-link heading3"><div>前端部分</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据同构" class="anchor-link heading2"><div>数据同构</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#后端实现" class="anchor-link heading3"><div>后端实现</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#前端实现" class="anchor-link heading3"><div>前端实现</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据脱水" class="anchor-link heading3"><div>数据脱水</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#数据注水" class="anchor-link heading3"><div>数据注水</div></a></li><li class="anchor"><a href="/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/SSR/#完善-tdk-信息" class="anchor-link heading3"><div>完善 TDK 信息</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="ssr-原理与实践"><a href="#ssr-原理与实践" class="header-anchor">#</a> SSR 原理与实践</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <h3 id="前端渲染方式的发展历程"><a href="#前端渲染方式的发展历程" class="header-anchor">#</a> 前端渲染方式的发展历程</h3> <table><thead><tr><th>阶段</th> <th>实现方式</th></tr></thead> <tbody><tr><td>1. 早期 SSR</td> <td>基于模板引擎（PHP、JSP）生成静态 HTML 页面</td></tr> <tr><td>2. CSR</td> <td>基于 SPA 框架，在客户端进行动态渲染</td></tr> <tr><td>3. 同构 SSR</td> <td>基于同一套代码在服务端和客户端都能执行的特点实现。<strong>首次访问页面为 SSR，后续交互为 SPA 的体验</strong></td></tr></tbody></table> <h3 id="各阶段的优缺点对比"><a href="#各阶段的优缺点对比" class="header-anchor">#</a> 各阶段的优缺点对比</h3> <table><thead><tr><th></th> <th style="text-align:center;">早期 SSR</th> <th style="text-align:center;">CSR（SPA）</th> <th style="text-align:center;">同构 SSR</th></tr></thead> <tbody><tr><td>首屏速度</td> <td style="text-align:center;">好</td> <td style="text-align:center;">差</td> <td style="text-align:center;">好</td></tr> <tr><td>SEO</td> <td style="text-align:center;">好</td> <td style="text-align:center;">差</td> <td style="text-align:center;">好</td></tr> <tr><td>页面跳转体验</td> <td style="text-align:center;">差，跳转需要刷新</td> <td style="text-align:center;">好</td> <td style="text-align:center;">好</td></tr> <tr><td>服务器压力</td> <td style="text-align:center;">高</td> <td style="text-align:center;">低</td> <td style="text-align:center;">高</td></tr></tbody></table> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/23/16fd0b2ba631fb35~tplv-t2oaga2asx-jj-mark:2268:0:0:0:q75.awebp" alt="渲染过程对比"></p> <h3 id="为什么需要同构-ssr"><a href="#为什么需要同构-ssr" class="header-anchor">#</a> 为什么需要同构 SSR</h3> <ul><li><strong>更快的首屏加载速度</strong>。首页为直接返回的完整 HTML，能更快看到内容</li> <li><strong>更好的 SEO</strong>。SSR 生成的 HTML 页面可以被搜索引擎爬虫直接解析</li> <li><strong>更好的渐进增强体验：</strong>。 用户在加载页面时首先会看到服务器端渲染的内容，然后再下载并激活客户端 JS 代码</li></ul> <h2 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h2> <h3 id="将-react-组件转换为-html-字符串"><a href="#将-react-组件转换为-html-字符串" class="header-anchor">#</a> 将 React 组件转换为 HTML 字符串</h3> <p>React 的虚拟 Dom 为跨端提供了可能性，虚拟 Dom 是一个 JS 对象，不依赖浏览器，Node 端可以通过 <code>react-dom/server</code> 提供了相应的 API 将虚拟 Dom 转换成 HTML 字符串</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.jsx&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-dom/server&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
              &lt;html lang=&quot;en&quot;&gt;
              &lt;head&gt;
                  &lt;meta charset=&quot;UTF-8&quot;&gt;
                  &lt;title&gt;my react ssr&lt;/title&gt;
              &lt;/head&gt;
              &lt;body&gt;
                  &lt;div id=&quot;root&quot;&gt;
                     </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                  &lt;/div&gt;
              &lt;/body&gt;
              &lt;/html&gt;
              &lt;script type=&quot;text/javascript&quot;  src=&quot;index.js&quot;&gt;&lt;/script&gt;//这里绑定了 index.js代码，浏览器会下载后执行</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>前端代码中，使用 <code>hydrateRoot</code> 替代 <code>render</code>，进行水合。</p> <ol><li>首先根据服务端渲染出的 DOM 树生成 Fiber 树</li> <li>开始初始渲染，这个过程会生成客户端的 Fiber 树</li> <li>进行双端对比，如果对比结果有差异则更新 DOM，使其与客户端渲染结果一致</li></ol> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// index.js 文件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hydrateRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-dom/client&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.jsx&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>双端对比的方式：</p> <ul><li>React 16 之前：对每个节点生成 id，对比服务端和客户端计算出的 ID 值</li> <li>React 16 之后：对比双端生成的 Fiber 树</li></ul> <p>利用双端对比机制，如果 SSR 项目中某个页面不需要做 SSR，则可以在服务端渲染时返回一个最小 DOM 结构（如只有根节点），然后在双端对比后采用 CSR 的内容，这样可以减轻服务器的压力。</p> <h3 id="流式渲染"><a href="#流式渲染" class="header-anchor">#</a> 流式渲染</h3> <p>通过 <code>renderToPipeableStream</code> 可以将 React 组件树渲染为<a href="https://nodejs.org/api/stream.html" target="_blank" rel="noopener noreferrer">Node.js 流<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，实现流式传输。
流式传输不必等整个 Dom 树全部渲染完成，实现渐进式的传输。流式传输不需要等待 React 本身在浏览器中的加载，也不需要等待页面变为可交互。在任何 script 标签加载之前，服务端发送的 HTML 内容就会开始渐进式地显示。</p> <p>在渲染过程中，常用的功能点如下</p> <ul><li><p><strong>渐进式传输内容</strong>：<code>onShellReady</code> 在 shell 内容渲染完成时触发，可以在此处使用 pipe 方法开始进行流式传输。</p> <blockquote><p>Shell 内容是指 <code>Suspense</code> 组件 之外的所有内容</p></blockquote> <p>此时 Suspense 内容会用 template 标签作为占位符。当 Suspense 内容渲染完成时，会连同一个 JS 函数一起传输至浏览器。</p> <p>一旦开启传输 Shell 内容，就不能再更改状态码</p></li> <li><p><strong>完整传输内容</strong>: <code>onAllReady</code> 在所有内容渲染完成时触发，在此处开启流式传输，所有的 HTML 都会被包含在流中直接返回，而不会有任何渐进的加载。可以用于<strong>爬虫和 SSG （静态内容生成）</strong>。</p></li> <li><p><strong>渲染兜底处理</strong>：</p> <ul><li>Shell 内容渲染失败：此时默认不会返回任何内容，可以在 <code>onShellError</code> 中设置兜底内容</li> <li>Suspense 内容渲染失败：
<ul><li>服务端将会用 Suspense 的 fallback 内容</li> <li>客户端将会重试渲染这部分，如果加载成功，会替换 fallback 内容；如果仍然失败，则会抛出错误，由错误边界决定最终的渲染情况</li></ul></li></ul></li> <li><p><strong>异常处理</strong>：打印日志，设置状态码等操作</p> <ul><li>onShellError 会在 Shell 内容渲染出错时触发</li> <li>onError 在 Shell 内容和非 Shell 内容出错时都会触发</li></ul></li> <li><p><strong>终止渲染</strong>：使用返回的 abort 方法，可以终止剩余内容的渲染。通常用于超时处理</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pipe<span class="token punctuation">,</span> abort <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderToPipeableStream</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要嵌入页面的JS文件，index.js中会完成客户端的水合</span>
    <span class="token literal-property property">bootstrapScripts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/index.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 在壳内容渲染完成时触发</span>
    <span class="token function">onShellReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">pipe</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 所有内容渲染完成时触发</span>
    <span class="token function">onAllReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 发生错误时触发</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 加载Shell内容时出错会触发</span>
    <span class="token function">onShellError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;出错了&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="路由同构"><a href="#路由同构" class="header-anchor">#</a> 路由同构</h2> <p><strong>路由同构可以实现的原理</strong>：</p> <ul><li>react-router-dom 提供了服务端和浏览器端的 API：<code>StaticRouter</code>。其内部通过 Route 匹配路由，写法和浏览器端 API 相同</li> <li>公共目录内定义路由配置，在服务端代码和客户端代码中引用同一份配置</li></ul> <p><strong>路由工作效果</strong>：</p> <ul><li>浏览器中初次访问页面时，<code>StaticRouter</code> 根据路径，选取对应的页面组件，直出 HTML</li> <li>后续路径切换，浏览器端控制，不会再向服务端发送请求（避免了早期 SSR 切换页面需要请求服务端带来的体验问题）</li></ul> <h3 id="路由定义"><a href="#路由定义" class="header-anchor">#</a> 路由定义</h3> <p>首先定义路由，前后端共用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// route.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/index&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> Index<span class="token punctuation">,</span>
    <span class="token literal-property property">exact</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> Home<span class="token punctuation">,</span>
    <span class="token literal-property property">exact</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// App.jsx</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> routeList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>routeList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Route exact key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>path<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="后端部分"><a href="#后端部分" class="header-anchor">#</a> 后端部分</h3> <p>服务端使用 <code>StaticRouter</code> 。它不依赖浏览器，通过传入的 <code>location</code> 属性判断当前的路由，选取当前要展示的页面。</p> <p>其内部仍通过 Route 组件进行路由匹配，和浏览器端的写法完全一致</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ctx.request.path&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
  <span class="token keyword">const</span> otherData <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>path<span class="token punctuation">}</span> context<span class="token operator">=</span><span class="token punctuation">{</span>otherData<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>App routeList<span class="token operator">=</span><span class="token punctuation">{</span>routeList<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;my react ssr&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script type=&quot;text/javascript&quot;  src=&quot;/index.js&quot;&gt;&lt;/script&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="前端部分"><a href="#前端部分" class="header-anchor">#</a> 前端部分</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ReactDom<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>App routeList<span class="token operator">=</span><span class="token punctuation">{</span>routeList<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="数据同构"><a href="#数据同构" class="header-anchor">#</a> 数据同构</h2> <p>数据同构是指服务端渲染时和客户端初始渲染时，使用同一份数据。</p> <p>服务端渲染时会遇到两个问题</p> <ol><li>客户端请求使用的 API（如 fetch）可能不支持 Node 环境</li> <li>组件使用的 <code>useEffect</code>、<code>componentDidMount</code> 等生命周期不会执行。此外</li></ol> <p>问题 1 的结局方式是引入同时支持两种环境的请求库，如 axios。</p> <p>对于问题 2，需要在渲染组件前执行数据预取，将请求得到的数据传入组件 props。</p> <p>参考 Next.js 的设计，可以让组件提供一个 <code>getInitialProps</code> 方法。将请求后的数据挂载到组件的 <code>props.initialData</code>。</p> <blockquote><p>相关属性的命名并没有特殊含义，形成约定即可</p></blockquote> <h3 id="后端实现"><a href="#后端实现" class="header-anchor">#</a> 后端实现</h3> <p>数据预取的结果可以通过 StaticRouter 的 context 传递，或通过 React 的 context、redux 等都可以。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 基于react-router 的 matchPath匹配当前路由，寻找匹配的组件targetComponent，省略具体实现</span>
<span class="token keyword">const</span> getInitialProps <span class="token operator">=</span> targetComponent<span class="token punctuation">.</span>getInitialProps<span class="token punctuation">;</span>
<span class="token keyword">let</span> initialData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>getInitialProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  initialData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getInitialProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">initialData</span><span class="token operator">:</span> fetchResult<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>path<span class="token punctuation">}</span> context<span class="token operator">=</span><span class="token punctuation">{</span>context<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App routeList<span class="token operator">=</span><span class="token punctuation">{</span>routeList<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="前端实现"><a href="#前端实现" class="header-anchor">#</a> 前端实现</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>initialData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
App<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="数据脱水"><a href="#数据脱水" class="header-anchor">#</a> 数据脱水</h3> <p>进行数据预取后，页面上的内容只会一闪而过。这是因为只在服务端进行了请求，导致双端节点对比失败，最终使用了客户端渲染的无数据版本。</p> <p>要解决这个问题，可以将请求的数据连同 HTML 一起发送到浏览器。</p> <p>将数据注入 HTML 的方式有很多，如作为 JSON 数据放入 script 标签（Next.js）、挂载到 window 对象（egg-react-ssr）、放入 textarea 标签等等。</p> <h3 id="数据注水"><a href="#数据注水" class="header-anchor">#</a> 数据注水</h3> <p>客户端注水，即在开始渲染前先获取 HTML 中携带的数据，将其用于渲染。</p> <ul><li>首先获取数据，这一步根据数据脱水的实现方式有所不同</li> <li>将数据传给匹配当前路由的页面，这一步可以通过 React 的 context、redux 等实现</li></ul> <h3 id="完善-tdk-信息"><a href="#完善-tdk-信息" class="header-anchor">#</a> 完善 TDK 信息</h3> <p>TDK 信息是指网页的标题（Title）、描述（Description）、关键词（Keywords），其目的是优化 SEO。</p> <p>如果网页的 TDK 信息是固定的，在 HTML 模板中直接写死即可。如果需要通过接口获取动态生成，则可以在数据预取的时候，固定在某个字段中保留 TDK 信息。使用 <code>react-helmet</code> 可以方便的实现双端同构</p> <p>前端通过数据预取存储的数据，通过 Helmet 组件设置 TDK 信息，无需手动修改 DOM</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Helmet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-helmet&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// 获取信息，这一步基于数据预取的实现方式会有所不同</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> tdk <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>initialData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Helmet<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token punctuation">{</span>tdk<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;description&quot;</span> content<span class="token operator">=</span><span class="token punctuation">{</span>tdk<span class="token punctuation">.</span>description<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;keywords&quot;</span> content<span class="token operator">=</span><span class="token punctuation">{</span>tdk<span class="token punctuation">.</span>keywords<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Helmet<span class="token operator">&gt;</span>
      首页
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>后端通过 Helmet.renderStatic 方法获取数据。</p> <p>renderStatic 必须在 renderToString 方法之后调用，Helmet 内部会存储 Helmet 组件内传入的 TDK 信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Helmet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-helmet&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tdkInfo <span class="token operator">=</span> Helmet<span class="token punctuation">.</span><span class="token function">renderStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helmet<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>helmet<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    &lt;meta name=&quot;keywords&quot; content=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tdk<span class="token punctuation">.</span>keywords<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; /&gt;
    &lt;meta name=&quot;description&quot; content=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tdk<span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; /&gt;
&lt;/head&gt;
//....
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">May 9, 2024 15:19</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 56068056+Youky1@users.noreply.github.com" class="contributor">
          Youky
        </span> , <span title="email: 1911303982@qq.com" class="contributor">
          Youky1
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.300783a1.js" defer></script><script src="/assets/js/vendors~layout-Layout.ffcec671.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.61e71969.js" defer></script><script src="/assets/js/page-SSR原理与实践.74b01f49.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.ec610c62.js" defer></script>
  </body>
</html>
